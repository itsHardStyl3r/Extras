{
    "version": "127.0.5778.41",
    "description": "Opera GX is a special version of the Opera browser built specifically for gamers.",
    "homepage": "https://www.opera.com/gx",
    "license": {
        "identifier": "Freeware",
        "url": "https://www.opera.com/eula/computers"
    },
    "architecture": {
        "64bit": {
            "url": "https://get.opera.com/pub/opera_gx/127.0.5778.41/win/Opera_GX_127.0.5778.41_Setup_x64.exe#/dl.7z",
            "hash": "2c71e2b617b6e9ec2a0a8a089bef552acf12714ce491cc1f92bb5e27ffc0ea42"
        },
        "32bit": {
            "url": "https://get.opera.com/pub/opera_gx/127.0.5778.41/win/Opera_GX_127.0.5778.41_Setup.exe#/dl.7z",
            "hash": "7d38232bfd889efccd232d656ea4cc33b036983fa8127ad7f6305e581cc7a149"
        }
    },
    "installer": {
        "script": [
            "Remove-Item -Path \"$dir\\*_list\" -Force -ErrorAction SilentlyContinue",
            "$version, 'autoupdate' | ForEach-Object { ensure \"$dir\\$_\" | Out-Null }",
            "Move-Item -Path \"$dir\\opera_autoupdate*\" -Destination \"$dir\\autoupdate\" -Force",
            "$exclude_list = @('Assets', $version, 'autoupdate', 'Resources.pri', 'opera.visualelementsmanifest.xml')",
            "Get-ChildItem -Path $dir | Where-Object { $exclude_list -notcontains $_.Name } | ForEach-Object {",
            "    $destination_dir = Join-Path $dir \"$version\\$($_.Name)\"",
            "    Move-Item -Path $_.FullName -Destination $destination_dir -Force -ErrorAction SilentlyContinue",
            "}",
            "Copy-Item -Path \"$dir\\$version\\opera.exe\" -Destination $dir -Force",
            "$cfg = @{ 'autoupdate'= $false; 'enable_stats' = $false; 'single_profile' = $true } | ConvertTo-Json",
            "Set-Content -Path \"$dir\\installer_prefs.json\" -Value $cfg -Encoding ASCII"
        ]
    },
    "shortcuts": [
        [
            "opera.exe",
            "Opera GX"
        ]
    ],
    "persist": "profile",
    "checkver": {
        "script": [
            "$version_regex = '^(?!\\.)[\\d.]+/$'",
            "$version_sort = { [version]$_.href.TrimEnd('/') }",
            "$releases = 'https://get.opera.com/pub/opera_gx/'",
            "$download_page = Invoke-WebRequest -Uri $releases -UseBasicParsing",
            "$version_segments = $download_page.links | Where-Object href -Match $version_regex | Sort-Object $version_sort -Descending | Select-Object -Expand href",
            "foreach ($version_segment in $version_segments) {",
            "    $version_url = $releases + $version_segment",
            "    $version_page = Invoke-WebRequest -Uri $version_url -UseBasicParsing",
            "    if ($null -ne $version_page -and $version_page.Content -match 'win') {",
            "        Write-Output $version_segment",
            "        break",
            "    }",
            "}"
        ],
        "regex": "([\\d.]+)/"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://get.opera.com/pub/opera_gx/$version/win/Opera_GX_$version_Setup_x64.exe#/dl.7z"
            },
            "32bit": {
                "url": "https://get.opera.com/pub/opera_gx/$version/win/Opera_GX_$version_Setup.exe#/dl.7z"
            }
        },
        "hash": {
            "url": "$url.sha256sum"
        }
    }
}
